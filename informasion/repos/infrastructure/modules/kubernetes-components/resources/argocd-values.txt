global:
  additionalLabels:
    backstage.io/kubernetes-id: argocd
controller:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      selector:
        release: prometheus-operator
    rules:
      enabled: true
      selector:
        release: prometheus-operator
      spec:
        - alert: ArgoAppNotSynced
          expr: |
            argocd_app_info{sync_status!="Synced"} == 1
          for: 12h
          labels:
            severity: warning
          annotations:
            summary: "[{{`{{$labels.name}}`}}] Application not synchronized"
            description: >
              The application [{{`{{$labels.name}}`}} has not been synchronized for over
              12 hours which means that the state of this cloud has drifted away from the
              state inside Git.
configs:
  params:
    server.insecure: true
  cm:
    admin.enabled: false
    accounts.admin: apiKey
    url: https://argocd-internal.pukara.dev
    dex.config: |
      connectors:
        - type: github
          id: github
          name: GitHub
          config:
            clientID: 365b7d0062a6db616b18
            clientSecret: ${oauth_client_secret}
            orgs:
            - name: pukara-dev
  rbac:
    # match by github username using preferred_username
    scopes: '[groups, preferred_username]'
    policy.default: 'role:readonly'
    policy.csv: |
      p, role:admin, applications, *, */*, allow
      g, mogaal, role:admin
      g, jaacu, role:admin
      g, eddymdz, role:admin
      g, pabloberrettoni, role:admin
      g, ricardocamacho, role:admin
      g, joseluiscodesk8, role:admin
