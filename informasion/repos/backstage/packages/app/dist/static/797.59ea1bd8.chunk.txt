"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[797],{70797:(Q,h,t)=>{t.r(h),t.d(h,{ArgoCDHistoryCard:()=>G});var D=t(65229),I=t(48475),u=t(18139),E=t(54195),N=t(16400),M=t(32293),R=t(88951),a=t(14041),$=t(80663),T=t(36978),C=t(53538),H=t(41683),U=t(41078),x=t(49203),B=t(58007),A=t(8109),F=t(77714),c=t(52950);const P=({data:s,retry:r})=>{const n=(0,u.gf)(E.U),p=n.getOptionalBoolean("argocd.namespacedApps")??!1,l=n.getOptionalString("argocd.baseUrl"),m=!!n.getOptionalConfigArray("argocd.appLocatorMethods")?.length,g=e=>{if(m&&!l){const v=n.getConfigArray("argocd.appLocatorMethods").find(i=>i.getOptionalString("type")==="config")?.getOptionalConfigArray("instances")?.find(i=>i.getOptionalString("name")===e?.instance);return v?.getOptionalString("frontendUrl")??v?.getOptionalString("url")}return l},f=[{title:"Name",field:"name",render:e=>g?a.createElement(x.A,{href:`${g(e)}/applications/${p?`${e.appNamespace}/${e.app}`:e.app}`,target:"_blank",rel:"noopener"},e.app):e.app},{title:"Deploy Details",defaultSort:"desc",field:"deployedAt",render:e=>a.createElement(B.A,{dense:!0,style:{padding:"0px"}},a.createElement(A.A,{style:{paddingLeft:"0px"}},e.deployedAt?`Deployed at ${c.c9.fromISO(e.deployedAt).toLocal().toFormat("dd MMM yyyy, HH:mm:ss")}`:null),a.createElement(A.A,{style:{paddingLeft:"0px"}},e.deployStartedAt?`Run ${c.c9.fromISO(e.deployStartedAt).toLocal().toRelative()}`:null),a.createElement(A.A,{style:{paddingLeft:"0px"}},e.deployedAt&&e.deployStartedAt?`Took ${c.c9.fromISO(e.deployStartedAt).diff(c.c9.fromISO(e.deployedAt)).toFormat("hh:mm:ss")}`:null))},{title:"Author",field:"revisionDetails.author",render:e=>a.createElement("div",null,e.revisionDetails?.author||"Loading...")},{title:"Message",field:"revisionDetails.message",render:e=>a.createElement("div",null,e.revisionDetails?.message||"Loading...")},{title:"Revision",field:"revision",render:e=>a.createElement("div",null,e.revision)}];return m&&f.splice(1,0,{title:"Instance",field:"instance",render:e=>e.metadata?.instance?.name?e.metadata?.instance?.name:e.instance}),a.createElement(U.X,{title:"ArgoCD history",options:{paging:!0,search:!1,draggable:!1,padding:"dense"},data:s,columns:f,actions:[{icon:()=>a.createElement(F.A,null),tooltip:"Refresh",isFreeAction:!0,onClick:()=>r()}]})},j=s=>s.source?.chart!==void 0,V=s=>s.revision.hasOwnProperty("revisionID")?s.revision.revisionID:s.revision,X=async(s,r,n)=>j(n)?(n.revisionDetails={author:"n/a",message:"n/a",date:"n/a"},n):(n.revisionDetails=await s.getRevisionDetails({url:r,app:n.app,appNamespace:n.appNamespace,revisionID:V(n),instanceName:n.instance}),n),z=({entity:s})=>{const[r,n]=(0,a.useState)([]),p=(0,u.gf)(H.y),{url:l,appName:m,appSelector:g,appNamespace:f,projectName:e}=(0,C.nD)({entity:s}),{loading:v,value:i,error:S,retry:J}=(0,T.T)({url:l,appName:m,appSelector:g,appNamespace:f,projectName:e}),O=(0,u.gf)(E.U).getOptionalNumber("argocd.revisionsToLoad")||-1;return(0,a.useEffect)(()=>{if(!i)return;let y;i.items!==void 0?y=i.items??[]:Array.isArray(i)?y=i:y=[i];const L=y.filter(o=>o?.status?.history).flatMap(o=>o.status.history.sort((d,K)=>new Date(K.deployedAt||"").valueOf()-new Date(d.deployedAt||"").valueOf()).slice(0,O).map(d=>({key:`${o.metadata.name}-${d.revision}`,app:o.metadata.name,appNamespace:o.metadata.namespace,instance:o.metadata?.instance?.name,...d})));n(L),Promise.all(L.map(async o=>await X(p,l,o))).then(o=>{n(o.filter(d=>d))})},[i,p,l,O]),v?a.createElement(D.n,{title:"ArgoCD history"},a.createElement(R.A,null)):S?a.createElement(D.n,{title:"ArgoCD history"},"Error occurred while fetching data. ",S.message):r.length?a.createElement(P,{data:r,retry:J}):null},G=()=>{const{entity:s}=(0,N.tN)();return(0,$.a)(s)?a.createElement(I.t,null,a.createElement(z,{entity:s})):a.createElement(M.o,{annotation:C.TV})}}}]);})();

//# sourceMappingURL=797.59ea1bd8.chunk.js.map