(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8664],{19953:(nt,U,e)=>{var t=e(72195),F=t(function(N,z,W){N[W?0:1].push(z)},function(){return[[],[]]});nt.exports=F},23164:(nt,U,e)=>{"use strict";var t,F=e(4293),N=e(78920);t={value:!0},U.A=void 0;var z=N(e(14041)),W=F(e(74044)),$=(0,W.default)(z.createElement("path",{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");U.A=$},56420:(nt,U,e)=>{"use strict";e.d(U,{Y:()=>v});var t=e(31085),F=e(95208),N=e(18139),z=e(54195),W=e(77125),$=e(64947),ct=e(93453),f=e(29365),Y=e(46423),S=e(5951),Z=e(26343),dt=e(28233),st=e(55197),pt=e(58837),m=e(72501),k=e(5893),Q=e(14041),Et=e(45250),K=e.n(Et),q=e(70209),G=e(92483),ut=e(75202),ot=e(89475),mt=e(10265);const ht=(0,pt.A)({popoverList:{minWidth:260,maxWidth:400},menuItem:{whiteSpace:"normal"}},{name:"BackstageSupportButton"}),gt=({icon:E})=>{const D=(0,F.n)(),I=E?D.getSystemIcon(E)??G.NT:G.NT;return(0,t.jsx)(I,{})},xt=({link:E})=>(0,t.jsx)(ut.N_,{to:E.url,children:E.title??E.url}),J=({item:E})=>(0,t.jsxs)(Z.A,{button:!1,children:[(0,t.jsx)(Y.A,{children:(0,t.jsx)(gt,{icon:E.icon})}),(0,t.jsx)(S.A,{primary:E.title,secondary:E.links?.reduce((D,I,T)=>[...D,T>0&&(0,t.jsx)("br",{},T),(0,t.jsx)(xt,{link:I},I.url)],[])})]});function v(E){const{t:D}=(0,mt.i)(ot.O),{title:I,items:T,children:_}=E,{items:vt}=(0,q.l)(),[w,L]=(0,Q.useState)(!1),[M,jt]=(0,Q.useState)(null),X=ht(),at=(0,N.gf)(z.U).getOptionalConfig("app.support"),tt=(0,k.A)(B=>B.breakpoints.down("sm")),H=B=>{jt(B.currentTarget),L(!0)},O=()=>{L(!1)};return at?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(W.A,{display:"flex",ml:1,children:tt?(0,t.jsx)(f.A,{color:"primary",size:"small",onClick:H,"data-testid":"support-button","aria-label":"Support",children:(0,t.jsx)(G.NT,{})}):(0,t.jsx)($.A,{"data-testid":"support-button","aria-label":"Support",color:"primary",onClick:H,startIcon:(0,t.jsx)(G.NT,{}),children:D("supportButton.title")})}),(0,t.jsxs)(st.Ay,{"data-testid":"support-button-popover",open:w,anchorEl:M,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:O,children:[(0,t.jsxs)(dt.A,{className:X.popoverList,autoFocusItem:!!M,children:[I&&(0,t.jsx)(Z.A,{button:!1,alignItems:"flex-start",className:X.menuItem,children:(0,t.jsx)(m.A,{variant:"subtitle1",children:I})}),Q.Children.map(_,(B,b)=>(0,t.jsx)(Z.A,{button:!1,alignItems:"flex-start",className:X.menuItem,children:B},`child-${b}`)),(T??vt).map((B,b)=>(0,t.jsx)(J,{item:B},`item-${b}`))]}),(0,t.jsx)(ct.A,{children:(0,t.jsx)($.A,{color:"primary",onClick:O,"aria-label":"Close",children:D("supportButton.close")})})]})]}):null}},88664:(nt,U,e)=>{"use strict";e.r(U),e.d(U,{ImportPage:()=>ge});var t=e(31085),F=e(18690),N=e(82326),z=e(79182),W=e(16454),$=e(17138),ct=e(56420),f=e(18139),Y=e(54195),S=e(42899),Z=e(5893),dt=e(54917),st=e(21332),pt=e(67720),m=e(72501),k=e(5336),Q=e(92939),Et=e(52536),K=e(3969);function q(){const n=(0,f.gf)(Y.U);return(0,K.J7)(n)}var G=e(10265),ut=e(97963);const ot=(0,ut.h)({id:"catalog-import",messages:{pageTitle:"Register an existing component",importInfoCard:{title:"Register an existing component"}}}),mt=n=>{const{exampleLocationUrl:s="https://github.com/backstage/backstage/blob/master/catalog-info.yaml",exampleRepositoryUrl:o="https://github.com/backstage/backstage"}=n,{t:a}=(0,G.i)(ot),r=(0,f.gf)(Y.U),l=r.getOptionalString("app.title")||"Backstage",c=(0,f.gf)(k.g),i=r.has("integrations.github"),p=q();return(0,t.jsxs)(st.n,{title:a("importInfoCard.title"),titleTypographyProps:{component:"h3"},deepLink:{title:"Learn more about the Software Catalog",link:"https://backstage.io/docs/features/software-catalog/"},children:[(0,t.jsxs)(m.A,{variant:"body2",paragraph:!0,children:["Enter the URL to your source code repository to add it to ",l,"."]}),(0,t.jsx)(m.A,{component:"h4",variant:"h6",children:"Link to an existing entity file"}),(0,t.jsxs)(m.A,{variant:"subtitle2",color:"textSecondary",paragraph:!0,children:["Example: ",(0,t.jsx)("code",{children:s})]}),(0,t.jsxs)(m.A,{variant:"body2",paragraph:!0,children:["The wizard analyzes the file, previews the entities, and adds them to the ",l," catalog."]}),i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.A,{component:"h4",variant:"h6",children:["Link to a repository"," ",(0,t.jsx)(pt.A,{label:"GitHub only",variant:"outlined",size:"small"})]}),(0,t.jsxs)(m.A,{variant:"subtitle2",color:"textSecondary",paragraph:!0,children:["Example: ",(0,t.jsx)("code",{children:o})]}),(0,t.jsxs)(m.A,{variant:"body2",paragraph:!0,children:["The wizard discovers all ",(0,t.jsx)("code",{children:p})," files in the repository, previews the entities, and adds them to the ",l," ","catalog."]}),c.preparePullRequest&&(0,t.jsxs)(m.A,{variant:"body2",paragraph:!0,children:["If no entities are found, the wizard will prepare a Pull Request that adds an example ",(0,t.jsx)("code",{children:p})," and prepares the ",l," catalog to load all entities as soon as the Pull Request is merged."]})]})]})};var ht=e(21619),gt=e(41045),xt=e(78733),J=e(58837),v=e(14041);function E(n){return{activeFlow:"unknown",activeState:"analyze",analysisUrl:n,previousStates:[]}}function D(n,s){switch(s.type){case"onAnalysis":{if(n.activeState!=="analyze")return n;const{activeState:o,previousStates:a}=n,[r,l,c,i]=s.args;return{...n,analysisUrl:l,activeFlow:r,analyzeResult:c,prepareResult:i?.prepareResult,activeState:i?.prepareResult===void 0?"prepare":"review",previousStates:a.concat(o)}}case"onPrepare":{if(n.activeState!=="prepare")return n;const{activeState:o,previousStates:a}=n,[r,l]=s.args;return{...n,prepareResult:r,activeState:"review",previousStates:l?.notRepeatable?[]:a.concat(o)}}case"onReview":{if(n.activeState!=="review")return n;const{activeState:o,previousStates:a}=n,[r]=s.args;return{...n,reviewResult:r,activeState:"finish",previousStates:a.concat(o)}}case"onGoBack":{const{activeState:o,previousStates:a}=n;return{...n,activeState:a.length>0?a[a.length-1]:o,previousStates:a.slice(0,a.length-1)}}case"onReset":return{...E(s.initialUrl),prepareResult:n.prepareResult};default:throw new Error}}const I=n=>{const[s,o]=(0,v.useReducer)(D,n?.initialUrl,E),{activeFlow:a,activeState:r,analysisUrl:l,previousStates:c}=s;return{activeFlow:a,activeState:r,activeStepNumber:["analyze","prepare","review","finish"].indexOf(r),analysisUrl:l,analyzeResult:s.analyzeResult,prepareResult:s.prepareResult,reviewResult:s.reviewResult,onAnalysis:(i,p,u,A)=>o({type:"onAnalysis",args:[i,p,u,A]}),onPrepare:(i,p)=>o({type:"onPrepare",args:[i,p]}),onReview:i=>o({type:"onReview",args:[i]}),onGoBack:c.length>0?()=>o({type:"onGoBack"}):void 0,onReset:()=>o({type:"onReset",initialUrl:n?.initialUrl})}};var T=e(77125),_=e(69076),vt=e(86901),w=e(51253),L=e(37877),M=e(16249),jt=e(87318),X=e(64947),at=e(78467);const tt=(0,J.A)(n=>({wrapper:{marginTop:n.spacing(1),marginRight:n.spacing(1),position:"relative"},buttonProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12},button:{marginTop:n.spacing(1),marginRight:n.spacing(1)}})),H=n=>{const{loading:s,...o}=n,a=tt();return(0,t.jsxs)("div",{className:a.wrapper,children:[(0,t.jsx)(X.A,{color:"primary",variant:"contained",...o,disabled:n.disabled||n.loading}),n.loading&&(0,t.jsx)(at.A,{size:"1.5rem",className:a.buttonProgress}),n.loading]})},O=n=>{const s=tt();return(0,t.jsx)(X.A,{variant:"outlined",className:s.button,...n,children:n.children||"Back"})},B=n=>{const s=tt();return(0,t.jsx)(jt.z,{color:"primary",variant:"contained",className:s.button,...n,children:n.children})};var b=e(52755),rt=e(78560),Mt=e(91072),bt=e(37281),Ft=e(45809),Nt=e(69621),zt=e(29365),Ct=e(58007),At=e(8109),Rt=e(46423),Wt=e(65569),yt=e(5951),Kt=e(23164),Gt=e(6924);const wt=(0,J.A)(n=>({nested:{paddingLeft:n.spacing(4)}})),et=n=>{const{locations:s,collapsed:o=!1,locationListItemIcon:a,onItemClick:r,firstListItem:l,withLinks:c=!1}=n,i=wt(),p=(0,f.gf)(Mt.n),[u,A]=(0,v.useState)([]),h=d=>{A(x=>x.includes(d)?x.filter(j=>j!==d):x.concat(d))};function g(d){return d.sort((x,j)=>p.forEntity((0,rt.U2)(x)).snapshot.entityRef.localeCompare(p.forEntity((0,rt.U2)(j)).snapshot.entityRef))}return(0,t.jsxs)(Ct.A,{children:[l,s.map(d=>(0,t.jsxs)(v.Fragment,{children:[(0,t.jsxs)(At.A,{dense:!0,button:!!r,onClick:()=>r?.(d.target),children:[(0,t.jsx)(Rt.A,{children:a(d.target)}),(0,t.jsx)(yt.A,{primary:d.target,secondary:`Entities: ${d.entities.length}`}),o&&(0,t.jsx)(Wt.A,{children:(0,t.jsx)(zt.A,{edge:"end",onClick:()=>h(d.target),children:u.includes(d.target)?(0,t.jsx)(Kt.A,{}):(0,t.jsx)(Gt.A,{})})})]}),(0,t.jsx)(Nt.A,{in:!o||u.includes(d.target),timeout:"auto",unmountOnExit:!0,children:(0,t.jsx)(Ct.A,{component:"div",disablePadding:!0,dense:!0,children:g(d.entities).map(x=>(0,t.jsx)(At.A,{className:i.nested,...c?{component:bt.z,entityRef:x,button:c}:{},children:(0,t.jsx)(yt.A,{primary:(0,t.jsx)(Ft.d,{entityRef:x})})},(0,rt.U2)(x)))})})]},d.target))]})};var Pt=e(75202),Ht=e(19953),St=e.n(Ht),Vt=e(55488),$t=e(20987),Yt=e(72814);const kt=n=>{for(const s of n)for(const o of s.entities)if(["component","api","resource"].includes(o.kind.toLocaleLowerCase("en-US")))return{kind:o.kind.toLocaleLowerCase("en-US"),namespace:o.namespace?.toLocaleLowerCase("en-US")??Vt.oQ,name:o.name};return null},Qt=({prepareResult:n,onReset:s})=>{const o=(0,Yt.S)($t.s);if(n.type==="repository")return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.A,{paragraph:!0,children:["The following Pull Request has been opened:"," ",(0,t.jsx)(Pt.N_,{to:n.pullRequest.url,target:"_blank",rel:"noreferrer",children:n.pullRequest.url})]}),(0,t.jsx)(m.A,{paragraph:!0,children:"Your entities will be imported as soon as the Pull Request is merged."}),(0,t.jsx)(S.A,{container:!0,spacing:0,children:(0,t.jsx)(O,{onClick:s,children:"Register another"})})]});const[a,r]=St()(n.locations,c=>c.exists),l=kt(r);return(0,t.jsxs)(t.Fragment,{children:[r.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.A,{children:"The following entities have been added to the catalog:"}),(0,t.jsx)(et,{locations:r,locationListItemIcon:()=>(0,t.jsx)(b.A,{}),withLinks:!0})]}),a.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.A,{children:"A refresh was triggered for the following locations:"}),(0,t.jsx)(et,{locations:a,locationListItemIcon:()=>(0,t.jsx)(b.A,{}),withLinks:!0})]}),(0,t.jsxs)(S.A,{container:!0,spacing:0,children:[l&&(0,t.jsx)(B,{to:o(l),children:"View Component"}),(0,t.jsx)(O,{onClick:s,children:"Register another"})]})]})};var Lt=e(24453),it=e(80824);const Jt=n=>{const{onAnalysis:s,analysisUrl:o="",disablePullRequest:a=!1,exampleLocationUrl:r="https://github.com/backstage/backstage/blob/master/catalog-info.yaml"}=n,l=(0,f.gf)(Lt.m),c=(0,f.gf)(k.g),{register:i,handleSubmit:p,formState:{errors:u},watch:A}=(0,it.mN)({mode:"onTouched",defaultValues:{url:o}}),[h,g]=(0,v.useState)(!1),[d,x]=(0,v.useState)(void 0),j=(0,v.useCallback)(async({url:y})=>{g(!0);try{const C=await c.analyzeUrl(y);switch(C.type){case"repository":!a&&C.generatedEntities.length>0?s("no-location",y,C):(x("Couldn't generate entities for your repository"),g(!1));break;case"locations":{C.locations.length===1?s("single-location",y,C,{prepareResult:C}):C.locations.length>1?s("multiple-locations",y,C):(x("There are no entities at this location"),g(!1));break}default:{const lt=`Received unknown analysis result of type ${C.type}. Please contact the support team.`;x(lt),g(!1),l.post(new Error(lt));break}}}catch(C){x(C?.data?.error?.message??C.message),g(!1)}},[c,a,l,s]);return(0,t.jsxs)("form",{onSubmit:p(j),children:[(0,t.jsx)(M.A,{...(0,K.eO)(i("url",{required:!0,validate:{httpsValidator:y=>typeof y=="string"&&y.match(/^http[s]?:\/\//)!==null||"Must start with http:// or https://."}})),fullWidth:!0,id:"url",label:"URL",placeholder:r,helperText:"Enter the full path to your entity file to start tracking your component",margin:"normal",variant:"outlined",error:!!u.url,required:!0}),u.url&&(0,t.jsx)(w.A,{error:!0,children:u.url.message}),d&&(0,t.jsx)(w.A,{error:!0,children:d}),(0,t.jsx)(S.A,{container:!0,spacing:0,children:(0,t.jsx)(H,{disabled:!!u.url||!A("url"),loading:h,type:"submit",children:"Analyze"})})]})};var Xt=e(61783);const Zt=n=>{const{name:s,options:o,required:a,errors:r,rules:l,loading:c=!1,loadingText:i,helperText:p,errorHelperText:u,textFieldProps:A={}}=n;return(0,t.jsx)(it.xI,{name:s,rules:l,render:({field:{onChange:h}})=>(0,t.jsx)(Xt.Ay,{loading:c,loadingText:i,options:o||[],autoSelect:!0,freeSolo:!0,onChange:(g,d)=>h(d),renderInput:g=>(0,t.jsx)(M.A,{...g,helperText:r?.[s]&&u||p,error:!!r?.[s],margin:"normal",variant:"outlined",required:a,InputProps:{...g.InputProps,endAdornment:(0,t.jsxs)(v.Fragment,{children:[c?(0,t.jsx)(at.A,{color:"inherit",size:"1em"}):null,g.InputProps.endAdornment]})},...A})})})};var qt=e(45250),It=e(67457),Tt=e(30043),_t=e(53318),Ot=e(73466);const te=n=>{const{defaultValues:s,onSubmit:o,render:a}=n,r=(0,it.mN)({mode:"onTouched",defaultValues:s}),{handleSubmit:l,watch:c,control:i,register:p,formState:u,setValue:A}=r;return(0,t.jsx)(it.Op,{...r,children:(0,t.jsx)("form",{onSubmit:l(o),children:a({values:c(),formState:u,register:p,control:i,setValue:A})})})};var Bt=e(40703),Ut=e(48653),Dt=e(45685),ee=e(62112);const ne=n=>{const{repositoryUrl:s,entities:o,classes:a}=n,r=q();return(0,t.jsxs)(Bt.A,{variant:"outlined",className:a?.card,children:[(0,t.jsx)(Dt.A,{title:(0,t.jsx)("code",{children:`${(0,qt.trimEnd)(s,"/")}/${r}`})}),(0,t.jsx)(Ut.A,{className:a?.cardContent,children:(0,t.jsx)(ee.z,{text:o.map(l=>Q.Ay.stringify(l)).join(`---
`).trim(),language:"yaml"})})]})};var se=e(28364);const oe=n=>{const{title:s,description:o,classes:a}=n;return(0,t.jsxs)(Bt.A,{variant:"outlined",className:a?.card,children:[(0,t.jsx)(Dt.A,{title:s,subheader:"Create a new Pull Request"}),(0,t.jsx)(Ut.A,{className:a?.cardContent,children:(0,t.jsx)(se.h,{content:o})})]})},ae=(0,J.A)(n=>({previewCard:{marginTop:n.spacing(1)},previewCardContent:{paddingTop:0}}));function ft(n,s,o){return n.map(a=>({...a,apiVersion:a.apiVersion,kind:a.kind,metadata:{...a.metadata,name:s},spec:{...a.spec,...o?{owner:o}:{}}}))}const re=n=>{const{analyzeResult:s,onPrepare:o,onGoBack:a,renderFormFields:r}=n,l=ae(),c=(0,f.gf)(Tt.v),i=(0,f.gf)(k.g),p=(0,f.gf)(Lt.m),[u,A]=(0,v.useState)(!1),[h,g]=(0,v.useState)(),d=q(),{loading:x,value:j,error:y}=(0,Ot.A)(()=>i.preparePullRequest(),[i.preparePullRequest]);(0,v.useEffect)(()=>{y&&p.post(y)},[y,p]);const{loading:C,value:lt}=(0,Ot.A)(async()=>(await c.getEntities({filter:{kind:"group"}})).items.map(P=>(0,_t.S)(P,{defaultKind:"group"})).sort()),xe=(0,v.useCallback)(async R=>{A(!0);try{const P=await i.submitPullRequest({repositoryUrl:s.url,title:R.title,body:R.body,fileContent:ft(s.generatedEntities,R.componentName,R.owner).map(V=>Q.Ay.stringify(V)).join(`---
`)});o({type:"repository",url:s.url,integrationType:s.integrationType,pullRequest:{url:P.link},locations:[{target:P.location,entities:ft(s.generatedEntities,R.componentName,R.owner).map(V=>({kind:V.kind,namespace:V.metadata.namespace,name:V.metadata.name}))}]},{notRepeatable:!0})}catch(P){(0,It.t)(P),g(P.message),A(!1)}},[s.generatedEntities,s.integrationType,s.url,i,o]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.A,{children:["You entered a link to a ",s.integrationType," repository but a"," ",(0,t.jsx)("code",{children:d})," could not be found. Use this form to open a Pull Request that creates one."]}),!x&&(0,t.jsx)(te,{onSubmit:xe,defaultValues:{title:j?.title??"",body:j?.body??"",owner:s.generatedEntities[0]?.spec?.owner||"",componentName:s.generatedEntities[0]?.metadata?.name||"",useCodeowners:!1},render:({values:R,formState:P,register:V,setValue:ve})=>(0,t.jsxs)(t.Fragment,{children:[r({values:R,formState:P,register:V,setValue:ve,groups:lt??[],groupsLoading:C}),(0,t.jsx)(T.A,{marginTop:2,children:(0,t.jsx)(m.A,{variant:"h6",children:"Preview Pull Request"})}),(0,t.jsx)(oe,{title:R.title,description:R.body,classes:{card:l.previewCard,cardContent:l.previewCardContent}}),(0,t.jsx)(T.A,{marginTop:2,marginBottom:1,children:(0,t.jsx)(m.A,{variant:"h6",children:"Preview Entities"})}),(0,t.jsx)(ne,{entities:ft(s.generatedEntities,R.componentName,R.owner),repositoryUrl:s.url,classes:{card:l.previewCard,cardContent:l.previewCardContent}}),h&&(0,t.jsx)(w.A,{error:!0,children:h}),(0,t.jsxs)(S.A,{container:!0,spacing:0,children:[a&&(0,t.jsx)(O,{onClick:a,disabled:u}),(0,t.jsx)(H,{type:"submit",disabled:!!(P.errors.title||P.errors.body||P.errors.owner),loading:u,children:"Create PR"})]})]})})]})},ie=({analyzeResult:n,prepareResult:s,onPrepare:o,onGoBack:a})=>{const[r,l]=(0,v.useState)(s?.locations.map(h=>h.target)||[]),[c,i]=St()(n?.locations,h=>h.exists),p=(0,v.useCallback)(async()=>{o({type:"locations",locations:i.filter(h=>r.includes(h.target))})},[i,o,r]),u=h=>{l(g=>g.includes(h)?g.filter(d=>d!==h):g.concat(h))},A=()=>{l(h=>h.length<i.length?i.map(g=>g.target):[])};return(0,t.jsxs)(t.Fragment,{children:[i.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.A,{children:"Select one or more locations that are present in your git repository:"}),(0,t.jsx)(et,{firstListItem:(0,t.jsxs)(At.A,{dense:!0,button:!0,onClick:A,children:[(0,t.jsx)(Rt.A,{children:(0,t.jsx)(_.A,{edge:"start",checked:r.length===i.length,indeterminate:r.length>0&&r.length<i.length,tabIndex:-1,disableRipple:!0})}),(0,t.jsx)(yt.A,{primary:"Select All"})]}),onItemClick:u,locations:i,locationListItemIcon:h=>(0,t.jsx)(_.A,{edge:"start",checked:r.includes(h),tabIndex:-1,disableRipple:!0}),collapsed:!0})]}),c.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.A,{children:"These locations already exist in the catalog:"}),(0,t.jsx)(et,{locations:c,locationListItemIcon:()=>(0,t.jsx)(b.A,{}),withLinks:!0,collapsed:!0})]}),(0,t.jsxs)(S.A,{container:!0,spacing:0,children:[a&&(0,t.jsx)(O,{onClick:a}),(0,t.jsx)(H,{disabled:r.length===0,onClick:p,children:"Review"})]})]})};var le=e(52262);const ce=({prepareResult:n,onReview:s,onGoBack:o})=>{const a=(0,f.gf)(Tt.v),r=(0,f.gf)(Y.U),l=(0,le.s)(),c=r.getOptionalString("app.title")||"Backstage",[i,p]=(0,v.useState)(!1),[u,A]=(0,v.useState)(),h=!!(n.type==="locations"&&n.locations.some(d=>d.exists)),g=(0,v.useCallback)(async()=>{p(!0),l.captureEvent("click","import entity");try{let d=new Array;n.type==="locations"&&(d=await Promise.all(n.locations.filter(j=>j.exists).map(async j=>{const y=(0,rt.U2)(j.entities[0]??j);return await a.refreshEntity(y),{target:j.target}})));const x=await Promise.all(n.locations.filter(j=>!j.exists).map(async j=>{const y=await a.addLocation({type:"url",target:j.target});return{target:y.location.target,entities:y.entities}}));s({...n,refreshed:d,locations:x})}catch(d){(0,It.t)(d),n.type==="repository"&&d.message.startsWith("Location was added but has no entities specified yet")?s({...n,locations:n.locations.map(x=>({target:x.target,entities:[]}))}):(A(d.message),p(!1))}},[n,s,a,l]);return(0,t.jsxs)(t.Fragment,{children:[n.type==="repository"&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.A,{paragraph:!0,children:["The following Pull Request has been opened:"," ",(0,t.jsx)(Pt.N_,{to:n.pullRequest.url,target:"_blank",rel:"noopener noreferrer",children:n.pullRequest.url})]}),(0,t.jsxs)(m.A,{paragraph:!0,children:["You can already import the location and ",c," will fetch the entities as soon as the Pull Request is merged."]})]}),(0,t.jsx)(m.A,{children:h?"The following locations already exist in the catalog:":"The following entities will be added to the catalog:"}),(0,t.jsx)(et,{locations:n.locations,locationListItemIcon:()=>(0,t.jsx)(b.A,{})}),u&&(0,t.jsx)(w.A,{error:!0,children:u}),(0,t.jsxs)(S.A,{container:!0,spacing:0,children:[o&&(0,t.jsx)(O,{onClick:o,disabled:i}),(0,t.jsx)(H,{disabled:i,loading:i,onClick:()=>g(),children:h?"Refresh":"Import"})]})]})};function de(n,s){switch(n){case"single-location":return{...s,prepare:()=>({stepLabel:(0,t.jsx)(L.A,{optional:(0,t.jsx)(m.A,{variant:"caption",children:"Discovered Locations: 1"}),children:"Select Locations"}),content:(0,t.jsx)(t.Fragment,{})})};case"multiple-locations":return{...s,prepare:(o,a)=>o.analyzeResult.type!=="locations"?s.prepare(o,a):{stepLabel:(0,t.jsx)(L.A,{optional:(0,t.jsxs)(m.A,{variant:"caption",children:["Discovered Locations: ",o.analyzeResult.locations.length]}),children:"Select Locations"}),content:(0,t.jsx)(ie,{analyzeResult:o.analyzeResult,prepareResult:o.prepareResult,onPrepare:o.onPrepare,onGoBack:o.onGoBack})}};case"no-location":return{...s,prepare:(o,a)=>o.analyzeResult.type!=="repository"?s.prepare(o,a):{stepLabel:(0,t.jsx)(L.A,{children:"Create Pull Request"}),content:(0,t.jsx)(re,{analyzeResult:o.analyzeResult,onPrepare:o.onPrepare,onGoBack:o.onGoBack,renderFormFields:({values:r,setValue:l,formState:c,groupsLoading:i,groups:p,register:u})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(T.A,{marginTop:2,children:(0,t.jsx)(m.A,{variant:"h6",children:"Pull Request Details"})}),(0,t.jsx)(M.A,{...(0,K.eO)(u("title",{required:!0})),label:"Pull Request Title",placeholder:"Add Backstage catalog entity descriptor files",margin:"normal",variant:"outlined",fullWidth:!0,error:!!c.errors.title,required:!0}),(0,t.jsx)(M.A,{...(0,K.eO)(u("body",{required:!0})),label:"Pull Request Body",placeholder:"A describing text with Markdown support",margin:"normal",variant:"outlined",fullWidth:!0,error:!!c.errors.body,multiline:!0,required:!0}),(0,t.jsx)(T.A,{marginTop:2,children:(0,t.jsx)(m.A,{variant:"h6",children:"Entity Configuration"})}),(0,t.jsx)(M.A,{...(0,K.eO)(u("componentName",{required:!0})),label:"Name of the created component",placeholder:"my-component",margin:"normal",variant:"outlined",fullWidth:!0,error:!!c.errors.componentName,required:!0}),!r.useCodeowners&&(0,t.jsx)(Zt,{name:"owner",errors:c.errors,options:p||[],loading:i,loadingText:"Loading groups\u2026",helperText:"Select an owner from the list or enter a reference to a Group or a User",errorHelperText:"required value",textFieldProps:{label:"Entity Owner",placeholder:"my-group"},rules:{required:!0},required:!0}),(0,t.jsx)(vt.A,{control:(0,t.jsx)(_.A,{...(0,K.eO)(u("useCodeowners")),onChange:(A,h)=>{h&&l("owner","")}}),label:(0,t.jsxs)(t.Fragment,{children:["Use ",(0,t.jsx)("em",{children:"CODEOWNERS"})," file as Entity Owner"]})}),(0,t.jsx)(w.A,{children:"WARNING: This may fail if no CODEOWNERS file is found at the target location."})]})})}};default:return s}}const pe={analyze:(n,{apis:s})=>({stepLabel:(0,t.jsx)(L.A,{children:"Select URL"}),content:(0,t.jsx)(Jt,{analysisUrl:n.analysisUrl,onAnalysis:n.onAnalysis,disablePullRequest:!s.catalogImportApi.preparePullRequest},"analyze")}),prepare:n=>({stepLabel:(0,t.jsx)(L.A,{optional:(0,t.jsx)(m.A,{variant:"caption",children:"Optional"}),children:"Import Actions"}),content:(0,t.jsx)(O,{onClick:n.onGoBack})}),review:n=>({stepLabel:(0,t.jsx)(L.A,{children:"Review"}),content:(0,t.jsx)(ce,{prepareResult:n.prepareResult,onReview:n.onReview,onGoBack:n.onGoBack})}),finish:n=>({stepLabel:(0,t.jsx)(L.A,{children:"Finish"}),content:(0,t.jsx)(Qt,{prepareResult:n.prepareResult,onReset:n.onReset})})},ue=(0,J.A)(()=>({stepperRoot:{padding:0}})),me=n=>{const{initialUrl:s,generateStepper:o=de,variant:a}=n,r=(0,f.gf)(k.g),l=ue(),c=I({initialUrl:s}),i=(0,v.useMemo)(()=>o(c.activeFlow,pe),[o,c.activeFlow]),p=u=>(0,t.jsxs)(ht.A,{children:[u.stepLabel,(0,t.jsx)(gt.A,{children:u.content})]});return(0,t.jsx)(st.n,{variant:a,children:(0,t.jsxs)(xt.A,{classes:{root:l.stepperRoot},activeStep:c.activeStepNumber,orientation:"vertical",children:[p(i.analyze(c,{apis:{catalogImportApi:r}})),p(i.prepare(c,{apis:{catalogImportApi:r}})),p(i.review(c,{apis:{catalogImportApi:r}})),p(i.finish(c,{apis:{catalogImportApi:r}}))]})})},he=()=>{const{t:n}=(0,G.i)(ot),s=(0,dt.A)(),o=(0,f.gf)(Y.U),a=(0,Z.A)(s.breakpoints.down("sm")),r=o.getOptionalString("app.title")||"Backstage",l=`Start tracking your component in ${r} by adding it to the software catalog.`,c=[(0,t.jsx)(S.A,{item:!0,xs:12,md:4,lg:6,xl:8,children:(0,t.jsx)(mt,{})},0),(0,t.jsx)(S.A,{item:!0,xs:12,md:8,lg:6,xl:4,children:(0,t.jsx)(me,{})},1)];return(0,t.jsxs)(N.Y,{themeId:"home",children:[(0,t.jsx)(z.Y,{title:n("pageTitle")}),(0,t.jsxs)(W.U,{children:[(0,t.jsx)($.d,{title:`Start tracking your component in ${r}`,children:(0,t.jsx)(ct.Y,{children:l})}),(0,t.jsx)(S.A,{container:!0,spacing:2,children:a?c:c.reverse()})]})]})},ge=()=>(0,F.P1)()||(0,t.jsx)(he,{})}}]);})();

//# sourceMappingURL=8664.1ca8a036.chunk.js.map