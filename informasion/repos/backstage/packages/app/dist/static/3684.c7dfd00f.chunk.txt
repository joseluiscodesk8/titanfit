"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3684],{54361:(rt,P,t)=>{t.d(P,{b:()=>L});var n=t(97214);const L=[[n.L8,n.vv],[n.Ey,n.fO],[n.IB,n.ZD],[n.sA,n.jn],[n.Kx,n.Qz],[n.zj,n.u0],[n.nC,n.fT]]},60332:(rt,P,t)=>{t.d(P,{L:()=>it});var n=t(31085),L=t(78560),$=t(80609),O=t(47090),H=t(18139),V=t(24453),Y=t(78467),M=t(58837),Z=t(54917),X=t(53373),j=t.n(X),R=t(14041),J=t(22249);const b=(0,J.A)(s=>({text:{fill:s.palette.textContrast},secondary:{fill:s.palette.textSubtle}}),{name:"PluginCatalogGraphCustomLabel"});function k({edge:{relations:s}}){const o=b();return(0,n.jsx)("text",{className:o.text,textAnchor:"middle",children:s.map((r,h)=>(0,n.jsxs)("tspan",{className:j()(h%2!==0&&o.secondary),children:[h>0&&(0,n.jsx)("tspan",{children:" / "}),r]},r))})}var w=t(46509),q=t(10437);function _({icon:s,...o}){const r=s??q.A;return(0,n.jsx)(r,{...o})}var U=t(55488);const T=(0,M.A)(s=>({node:{fill:s.palette.grey[300],stroke:s.palette.grey[300],"&.primary":{fill:s.palette.primary.light,stroke:s.palette.primary.light},"&.secondary":{fill:s.palette.secondary.light,stroke:s.palette.secondary.light}},text:{fill:s.palette.getContrastText(s.palette.grey[300]),"&.primary":{fill:s.palette.primary.contrastText},"&.secondary":{fill:s.palette.secondary.contrastText},"&.focused":{fontWeight:"bold"}},clickable:{cursor:"pointer"}}),{name:"PluginCatalogGraphCustomNode"});function tt({node:{id:s,entity:o,color:r="default",focused:h,onClick:l}}){const y=T(),[N,C]=(0,R.useState)(0),[x,A]=(0,R.useState)(0),d=(0,R.useRef)(null),a=(0,w.f)(o,{defaultNamespace:U.oQ});(0,R.useLayoutEffect)(()=>{if(d.current){let{height:G,width:i}=d.current.getBBox();G=Math.round(G),i=Math.round(i),(G!==x||i!==N)&&(C(i),A(G))}},[N,x]);const f=!!a.Icon,m=10,u=x,p=f?u+m:0,E=p+N+m*2,g=x+m*2,I=a.primaryTitle??s;return(0,n.jsxs)("g",{onClick:l,className:j()(l&&y.clickable),children:[(0,n.jsx)("rect",{className:j()(y.node,r==="primary"&&"primary",r==="secondary"&&"secondary"),width:E,height:g,rx:10}),f&&(0,n.jsx)(_,{icon:a.Icon,y:m,x:m,width:u,height:u,className:j()(y.text,h&&"focused",r==="primary"&&"primary",r==="secondary"&&"secondary")}),(0,n.jsx)("text",{ref:d,className:j()(y.text,h&&"focused",r==="primary"&&"primary",r==="secondary"&&"secondary"),y:g/2,x:p+(N+m*2)/2,textAnchor:"middle",alignmentBaseline:"middle",children:I}),(0,n.jsx)("title",{children:a.entityRef})]})}var z=t(54361),W=t(60241),B=t(22771),Q=t(30043),F=t(87290);function et(){const s=(0,H.gf)(Q.v),o=(0,R.useRef)({requestedEntities:new Set,outstandingEntities:new Map,cachedEntities:new Map}),[r,h]=(0,R.useState)({}),l=(0,R.useCallback)(()=>{const{cachedEntities:d,requestedEntities:a}=o.current,f={};a.forEach(m=>{const u=d.get(m);u&&(f[m]=u)}),h(f)},[o,h]),[y,N]=(0,F.A)(async()=>{const{requestedEntities:d,cachedEntities:a}=o.current,f=Array.from(d).filter(u=>!a.has(u));if(f.length===0){l();return}const{items:m}=await s.getEntitiesByRefs({entityRefs:f});m.forEach(u=>{if(u){const p=(0,L.U2)(u);a.set(p,u)}}),l()},[o,l]),{loading:C,error:x}=y,A=(0,R.useCallback)(d=>{const a=new Set(d),{requestedEntities:f}=o.current;(a.size!==f.size||Array.from(a).some(m=>!f.has(m)))&&(o.current.requestedEntities=a,N(),l())},[o,N,l]);return{entities:r,loading:C,error:x,requestEntities:A}}var st=t(45250);function nt({rootEntityRefs:s,filter:{maxDepth:o=Number.POSITIVE_INFINITY,relations:r,kinds:h,entityFilter:l}={}}){const{entities:y,loading:N,error:C,requestEntities:x}=et();return(0,R.useEffect)(()=>{const d=new Set([...s]),a=new Set;let f=[...s],m=0;for(;f.length>0&&(!isFinite(o)||m<o);){const u=f;for(f=[];u.length>0;){const p=u.shift(),E=y[p];if(a.add(p),E&&E.relations){if(l&&!l(E))continue;for(const g of E.relations)(!r||r.includes(g.type))&&(!h||h.some(I=>g.targetRef.startsWith(`${I.toLocaleLowerCase("en-US")}:`)))&&(a.has(g.targetRef)||(f.push(g.targetRef),d.add(g.targetRef)))}}++m}x([...d])},[y,s,o,r,h,l,x]),{entities:(0,R.useMemo)(()=>l?(0,st.pickBy)(y,(d,a)=>l(d)):y,[y,l]),loading:N,error:C}}function at({rootEntityRefs:s,maxDepth:o=Number.POSITIVE_INFINITY,unidirectional:r=!0,mergeRelations:h=!0,kinds:l,relations:y,entityFilter:N,onNodeClick:C,relationPairs:x=z.b}){const[A,d]=(0,R.useState)({}),{entities:a,loading:f,error:m}=nt({rootEntityRefs:s,filter:{maxDepth:o,kinds:l,relations:y,entityFilter:N}});return(0,B.A)(()=>{if(!a||Object.keys(a).length===0){d({});return}const u=Object.entries(a).map(([i,v])=>{const e=s.includes(i),c={id:i,entity:v,focused:e,color:e?"secondary":"primary",kind:v.kind,name:v.metadata.name,namespace:v.metadata.namespace||U.oQ,title:v.metadata.title,spec:v.spec};return C&&(c.onClick=S=>C(c,S)),c}),p=[],E=new Set,g=[...s],I=(i,v,e)=>p.some(c=>i===c.from&&v===c.to&&c.relations.some(S=>S[0]===e[0]&&S[1]===e[1]));for(;g.length>0;){const i=g.pop(),v=a[i];E.add(i),v&&v?.relations?.forEach(e=>{if(a[e.targetRef]&&!(y&&!y.includes(e.type))&&!(l&&!l.some(c=>e.targetRef.startsWith(`${c.toLocaleLowerCase("en-US")}:`)))){if(h){const c=x.find(([lt,ct])=>lt===e.type||ct===e.type)??[e.type],[S]=c,D=S===e.type?i:e.targetRef,K=S===e.type?e.targetRef:i;(!r||!I(D,K,c))&&p.push({from:D,to:K,relations:c,label:"visible"})}else(!r||!I(i,e.targetRef,[e.type]))&&p.push({from:i,to:e.targetRef,relations:[e.type],label:"visible"});if(E.has(e.targetRef)||(g.push(e.targetRef),E.add(e.targetRef)),r){const c=p.findIndex(S=>i===S.from&&e.targetRef===S.to&&!S.relations.includes(e.type));if(c>=0)if(h){const S=x.find(([D,K])=>D===e.type||K===e.type)??[e.type];p[c].relations=[...p[c].relations,...S]}else p[c].relations=[...p[c].relations,e.type]}}})}const G=p.reduce((i,v)=>{const e=i.findIndex(c=>c.from===v.from&&c.to===v.to);return e>=0?(i[e]={...i[e],relations:Array.from(new Set([...i[e].relations,...v.relations]))},i):[...i,v]},[]);d({nodes:u,edges:G})},100,[a,s,l,y,r,h,C,x]),{loading:f,error:m,...A}}const ot=(0,M.A)(s=>({progress:{position:"absolute",left:"50%",top:"50%",marginLeft:"-20px",marginTop:"-20px"},container:{position:"relative",width:"100%",display:"flex",flexDirection:"column"},graph:{width:"100%",flex:1,"& path[marker-end]":{transition:"filter 0.1s ease-in-out"},"& path[marker-end]:hover":{filter:`drop-shadow(2px 2px 4px ${s.palette.primary.dark});`},"& g[data-testid=label]":{transition:"transform 0s"}}}),{name:"PluginCatalogGraphEntityRelationsGraph"}),it=s=>{const{rootEntityNames:o,maxDepth:r=2,unidirectional:h=!0,mergeRelations:l=!0,kinds:y,relations:N,entityFilter:C,direction:x=W.O.LEFT_RIGHT,onNodeClick:A,relationPairs:d=z.b,className:a,zoom:f="enabled",renderNode:m,renderLabel:u,curve:p,showArrowHeads:E}=s,g=(0,Z.A)(),I=ot(),G=(0,R.useMemo)(()=>(Array.isArray(o)?o:[o]).map(D=>(0,L.U2)(D)),[o]),i=(0,H.gf)(V.m),{loading:v,error:e,nodes:c,edges:S}=at({rootEntityRefs:G,maxDepth:r,unidirectional:h,mergeRelations:l,kinds:y,relations:N,entityFilter:C,onNodeClick:A,relationPairs:d});return(0,R.useEffect)(()=>{e&&i.post(e)},[i,e]),(0,n.jsxs)("div",{className:j()(I.container,a),children:[v&&(0,n.jsx)(Y.A,{className:I.progress}),c&&S&&(0,n.jsx)($.w,{nodes:c,edges:S,renderNode:m||tt,renderLabel:u||k,direction:x,className:I.graph,paddingX:g.spacing(4),paddingY:g.spacing(4),labelPosition:O.D.LabelPosition.RIGHT,labelOffset:g.spacing(1),zoom:f,curve:p,showArrowHeads:E})]})}},93684:(rt,P,t)=>{t.r(P),t.d(P,{CatalogGraphCard:()=>U});var n=t(31085),L=t(78560),$=t(21332),O=t(72814),H=t(52262),V=t(16400),Y=t(20987),M=t(53318),Z=t(58837),X=t(45810),j=t.n(X),R=t(14041),J=t(18690),b=t(15496),k=t(60332),w=t(54361),q=t(60241);const _=(0,Z.A)({card:({height:T})=>({display:"flex",flexDirection:"column",maxHeight:T,minHeight:T}),graph:{flex:1,minHeight:0}},{name:"PluginCatalogGraphCatalogGraphCard"}),U=T=>{const{variant:tt="gridItem",relationPairs:z=w.b,maxDepth:W=1,unidirectional:B=!0,mergeRelations:Q=!0,direction:F=q.O.LEFT_RIGHT,kinds:et,relations:st,entityFilter:nt,height:at,className:ot,action:it,rootEntityNames:s,onNodeClick:o,title:r="Relations",zoom:h="enable-on-click"}=T,{entity:l}=(0,V.tN)(),y=(0,R.useMemo)(()=>(0,L.sM)(l),[l]),N=(0,O.S)(Y.s),C=(0,O.S)(b.c),x=(0,J.Zp)(),A=_({height:at}),d=(0,H.s)(),a=(0,R.useCallback)((u,p)=>{const E=(0,L.KU)(u.id),g=N({kind:E.kind.toLocaleLowerCase("en-US"),namespace:E.namespace.toLocaleLowerCase("en-US"),name:E.name});d.captureEvent("click",u.entity.metadata.title??(0,M.S)(E),{attributes:{to:g}}),x(g)},[N,x,d]),f=j().stringify({rootEntityRefs:[(0,L.U2)(l)],maxDepth:W,unidirectional:B,mergeRelations:Q,selectedKinds:et,selectedRelations:st,direction:F},{arrayFormat:"brackets",addQueryPrefix:!0}),m=`${C()}${f}`;return(0,n.jsx)($.n,{title:r,action:it,cardClassName:A.card,variant:tt,noPadding:!0,deepLink:{title:"View graph",link:m},children:(0,n.jsx)(k.L,{...T,rootEntityNames:s||y,onNodeClick:o||a,className:ot||A.graph,maxDepth:W,unidirectional:B,mergeRelations:Q,direction:F,relationPairs:z,entityFilter:nt,zoom:h})})}}}]);})();

//# sourceMappingURL=3684.c7dfd00f.chunk.js.map