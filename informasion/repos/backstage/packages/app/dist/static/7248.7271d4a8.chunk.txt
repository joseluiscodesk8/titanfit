"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7248],{15998:(st,A,t)=>{t.d(A,{$3:()=>h,Rr:()=>M,be:()=>f});var e=t(49724);function d(y){return!!y.getFullTextFilters}function P(y){return!!y.getOrderFilters}function h(y){const T=y.reduce((L,u)=>({...L,...u.getCatalogFilters?u.getCatalogFilters():{}}),{}),v=y.find(d)?.getFullTextFilters(),j=y.find(P)?.getOrderFilters()||[{field:"metadata.name",order:"asc"}];return{filter:T,fullTextFilter:v,orderFields:j}}function M(y){const T={};return y.forEach(v=>{v instanceof e.q_||v instanceof e.N9||v instanceof e.I5||v instanceof e.z||v instanceof e.tN||v instanceof e.Kf||v instanceof e.V3||v instanceof e.gZ||Object.assign(T,v.getCatalogFilters?.()||{})}),T}function f(y){return T=>y.every(v=>!v.filterEntity||v.filterEntity(T))}},18453:(st,A,t)=>{t.d(A,{B9:()=>$,nK:()=>E});var e=t(31085),d=t(45250),P=t.n(d),h=t(45810),M=t.n(h),f=t(14041),y=t(18690),T=t(87290),v=t(22771),j=t(71581),L=t(30043),u=t(15998),z=t(18139);const p=(0,f.createContext)(void 0),$=s=>{const c=(0,j.A)(),U=(0,z.gf)(L.v),[D,K]=(0,f.useState)({}),C=(0,y.zy)(),m=s.pagination===!0?"cursor":typeof s.pagination=="object"?s.pagination.mode??"cursor":"none",J=typeof s.pagination=="object"?s.pagination.limit??20:20,{queryParameters:Z,cursor:X,offset:k,limit:rt}=(0,f.useMemo)(()=>{const x=M().parse(C.search,{ignoreQueryPrefix:!0});let R=J;if(typeof x.limit=="string"){const n=Number.parseInt(x.limit,10);isNaN(n)||(R=n)}const r=typeof x.offset=="string"&&m==="offset"?Number.parseInt(x.offset,10):void 0;return{queryParameters:x.filters??{},cursor:typeof x.cursor=="string"&&m==="cursor"?x.cursor:void 0,offset:m==="offset"&&r&&!isNaN(r)?r:void 0,limit:R}},[m,C.search,J]),[I,V]=(0,f.useState)(X),[B,w]=(0,f.useState)(k),[Q,ut]=(0,f.useState)(rt),[S,q]=(0,f.useState)(()=>({appliedFilters:{},entities:[],backendEntities:[],pageInfo:{},offset:B,limit:Q})),[{loading:ot,error:Y},tt]=(0,T.A)(async()=>{const x=D.kind?.value?.toLocaleLowerCase("en-US"),R=x==="user"||x==="group"?{...D,owners:void 0}:D,r=(0,d.compact)(Object.values(R)),n=Object.keys(D).reduce((a,o)=>{const i=D[o];return i?.toQueryValue&&(a[o]=i.toQueryValue()),a},{});if(m!=="none")if(I){if(I!==S.appliedCursor){const a=(0,u.be)(r),o=await U.queryEntities({cursor:I,limit:Q});q({appliedFilters:D,appliedCursor:I,backendEntities:o.items,entities:o.items.filter(a),pageInfo:o.pageInfo,totalItems:o.totalItems})}}else{const a=(0,u.be)(r),o=(0,u.$3)(r),i=(0,u.$3)((0,d.compact)(Object.values(S.appliedFilters)));if(m==="offset"&&(S.limit!==Q||S.offset!==B)||!(0,d.isEqual)(i,o)){const l=await U.queryEntities({...o,limit:Q,offset:B});q({appliedFilters:D,backendEntities:l.items,entities:l.items.filter(a),pageInfo:l.pageInfo,totalItems:l.totalItems,limit:Q,offset:B})}}else{const a=(0,u.be)(r),o=(0,u.Rr)(r),i=(0,u.Rr)((0,d.compact)(Object.values(S.appliedFilters)));if((0,d.isEqual)(i,o)){const l=S.backendEntities.filter(a);q({appliedFilters:D,backendEntities:S.backendEntities,entities:l,totalItems:l.length})}else{const l=await U.getEntities({filter:o}),g=l.items.filter(a);q({appliedFilters:D,backendEntities:l.items,entities:g,totalItems:g.length})}}if(c()){const a=M().parse(C.search,{ignoreQueryPrefix:!0}),o=M().stringify({...a,filters:n,cursor:I,offset:B,limit:Q},{addQueryPrefix:!0,arrayFormat:"repeat"}),i=`${window.location.pathname}${o}`;window.history?.replaceState(null,document.title,i)}},[U,Z,D,S,I,m,Q,B],{loading:!0});(0,v.A)(tt,10,[D,I,Q,B]);const et=(0,f.useCallback)(x=>{m==="cursor"?V(void 0):m==="offset"&&w(0),K(R=>{const r=typeof x=="function"?x(R):x;return{...R,...r}})},[m]),it=(0,f.useMemo)(()=>{if(m!=="cursor")return;const x=S.pageInfo?.prevCursor,R=S.pageInfo?.nextCursor;return{prev:x?()=>V(x):void 0,next:R?()=>V(R):void 0}},[m,S.pageInfo]),lt=(0,f.useMemo)(()=>({filters:S.appliedFilters,entities:S.entities,backendEntities:S.backendEntities,updateFilters:et,queryParameters:Z,loading:ot,error:Y,pageInfo:it,totalItems:S.totalItems,limit:Q,offset:B,setLimit:ut,setOffset:w,paginationMode:m}),[S,et,Z,ot,Y,it,Q,B,m,ut,w]);return(0,e.jsx)(p.Provider,{value:lt,children:s.children})};function E(){const s=(0,f.useContext)(p);if(!s)throw new Error("useEntityList must be used within EntityListProvider");return s}},30117:(st,A,t)=>{t.d(A,{y:()=>r});var e=t(31085),d=t(18139),P=t(54195),h=t(40703),M=t(58007),f=t(46423),y=t(65569),T=t(5951),v=t(26343),j=t(72501),L=t(58837),u=t(9684),z=t(92483),p=t(14041),$=t(49724),E=t(18453),s=t(46343),c=t(40074),U=t(46123),D=t(96403),K=t(94223),C=t(45250),O=t(73466),m=t(30043),J=t(15998),Z=t(87290),X=function(n){return n!==Object(n)},k=function(n,a,o){var i=(0,p.useRef)(void 0);(!i.current||!o(a,i.current))&&(i.current=a),(0,p.useEffect)(n,i.current)};const rt=k;var I=t(56307),V=t.n(I);const B=V();var w=function(n){return n!==Object(n)},Q=function(n,a){rt(n,a,B)};const ut=Q;function S(){const n=(0,d.gf)(K.K),a=(0,d.gf)(m.v),{filters:o}=(0,E.nK)(),{value:i,loading:l}=(0,O.A)(async()=>(await n.getBackstageIdentity()).ownershipEntityRefs,[]),{user:g,owners:F,...H}=o,{orderFields:G,..._}=(0,J.$3)((0,C.compact)(Object.values(H))),[{value:b,loading:nt},ft]=(0,Z.A)(async at=>{const Et=q(at.owners,at.ownershipEntityRefs);if(Et===void 0)return 0;const{["metadata.name"]:N,...W}=at.filter.filter,{totalItems:dt}=await a.queryEntities({...at.filter,filter:{...W,"relations.ownedBy":Et},limit:0});return dt},[],{loading:!0});return ut(()=>{Object.keys(_.filter).length!==0&&i!==void 0&&ft({ownershipEntityRefs:i,owners:F,filter:_})},[i,F,_]),{count:b,loading:l||nt,filter:(0,p.useMemo)(()=>$.tN.owned(i??[]),[i]),ownershipEntityRefs:i}}function q(n,a){if(a===void 0)return;const o=n?.values??[];if(o.length){const i=(0,C.intersection)(o,a);return i.length===0?void 0:i}return a}function ot(){const n=(0,d.gf)(m.v),{filters:a}=(0,E.nK)(),o=(0,p.useRef)(),i=(0,p.useMemo)(()=>{const{user:F,...H}=a,G=(0,C.compact)(Object.values(H)),{orderFields:_,...b}=(0,J.$3)(G),nt={...b,limit:0};return Object.keys(b.filter).length===0?(o.current=void 0,o.current):(0,C.isEqual)(nt,o.current)?o.current:(o.current=nt,nt)},[a]),{value:l,loading:g}=(0,O.A)(async()=>{if(i===void 0)return 0;const{totalItems:F}=await n.queryEntities(i);return F},[i]);return{count:l,loading:g}}var Y=t(78560),tt=t(44861);function et(){const n=(0,d.gf)(m.v),{filters:a}=(0,E.nK)(),{starredEntities:o}=(0,tt.I)(),i=(0,p.useRef)(),l=(0,p.useMemo)(()=>{const{user:G,..._}=a,b=(0,C.compact)(Object.values(_)),{orderFields:nt,...ft}=(0,J.$3)(b),at={...ft,filter:{...ft.filter,["metadata.name"]:Array.from(o).map(Et=>(0,Y.KU)(Et).name)},limit:1e3};return(0,C.isEqual)(at,i.current)?i.current:(i.current=at,at)},[a,o]),{value:g,loading:F}=(0,O.A)(async()=>o.size?(await n.queryEntities(l)).items.map(_=>(0,Y.U2)({kind:_.kind,namespace:_.metadata.namespace,name:_.metadata.name})).filter(_=>o.has(_)).length:0,[l,o]),H=(0,p.useMemo)(()=>$.tN.starred(Array.from(o)),[o]);return{count:g,loading:F,filter:H}}var it=t(10265),lt=t(80084);const x=(0,L.A)(n=>({root:{backgroundColor:"rgba(0, 0, 0, .11)",boxShadow:"none",margin:n.spacing(1,0,1,0)},title:{margin:n.spacing(1,0,0,1),textTransform:"uppercase",fontSize:12,fontWeight:"bold"},listIcon:{minWidth:30,color:n.palette.text.primary},menuItem:{minHeight:n.spacing(6)},groupWrapper:{margin:n.spacing(1,1,2,1)}}),{name:"CatalogReactUserListPicker"});function R(n,a){return[{name:a("userListPicker.personalFilter.title"),items:[{id:"owned",label:a("userListPicker.personalFilter.ownedLabel"),icon:u.A},{id:"starred",label:a("userListPicker.personalFilter.starredLabel"),icon:z.Gg}]},{name:n,items:[{id:"all",label:a("userListPicker.orgFilterAllLabel")}]}]}const r=n=>{const{initialFilter:a,availableFilters:o,hidden:i,alwaysKeepFilters:l}=n,g=x(),F=(0,d.gf)(P.U),{t:H}=(0,it.i)(lt.j),G=F.getOptionalString("organization.name")??H("userListPicker.defaultOrgName"),{filters:_,updateFilters:b,queryParameters:{kind:nt,user:ft}}=(0,E.nK)(),gt=["starred","all"],at=R(G,H).map(mt=>({...mt,items:mt.items.filter(({id:ct})=>["group","user"].some(At=>At===nt)?gt.includes(ct):!o||o.includes(ct))})).filter(({items:mt})=>!!mt.length),{count:Et,loading:N,filter:W}=S(),{count:dt}=ot(),{count:pt,filter:Ct,loading:Mt}=et(),ht=(0,p.useMemo)(()=>[ft].flat()[0],[ft]),[vt,Ot]=(0,p.useState)(ht??a),Pt=(0,p.useMemo)(()=>({all:dt,starred:pt,owned:Et}),[pt,Et,dt]);(0,p.useEffect)(()=>{ht&&Ot(ht)},[ht]);const yt=N||Mt;return(0,p.useEffect)(()=>{!yt&&vt&&vt!=="all"&&Pt[vt]===0&&!l&&Ot("all")},[yt,Pt,vt,Ot,l]),(0,p.useEffect)(()=>{if(!vt||yt)return;b({user:vt==="owned"?W:vt==="starred"?Ct:$.tN.all()})},[vt,Ct,W,b,yt]),i?null:(0,e.jsx)(h.A,{className:g.root,children:at.map(mt=>(0,e.jsxs)(p.Fragment,{children:[(0,e.jsx)(j.A,{variant:"subtitle2",component:"span",className:g.title,children:mt.name}),(0,e.jsx)(h.A,{className:g.groupWrapper,children:(0,e.jsx)(M.A,{disablePadding:!0,dense:!0,role:"menu","aria-label":mt.name,children:mt.items.map((ct,At)=>(0,e.jsxs)(v.A,{role:"none presentation",divider:At!==mt.items.length-1,onClick:()=>Ot(ct.id),selected:ct.id===_.user?.value,className:g.menuItem,disabled:Pt[ct.id]===0,"data-testid":`user-picker-${ct.id}`,tabIndex:0,ContainerProps:{role:"menuitem"},children:[ct.icon&&(0,e.jsx)(f.A,{className:g.listIcon,children:(0,e.jsx)(ct.icon,{fontSize:"small"})}),(0,e.jsx)(T.A,{children:(0,e.jsxs)(j.A,{variant:"body1",children:[ct.label," "]})}),(0,e.jsx)(y.A,{children:Pt[ct.id]??"-"})]},ct.id))})})]},mt.name))})}},40941:(st,A,t)=>{t.d(A,{t:()=>R});var e=t(31085),d=t(78560),P=t(77125),h=t(69076),M=t(86901),f=t(72501),y=t(71677),T=t(58837),v=t(7031),j=t(44148),L=t(41260),u=t(14041),z=t(18453),p=t(49724),$=t(16261);function E(r){const n=(0,$.J)(r);(0,u.useEffect)(()=>()=>{n.current()},[])}function s(r,n,a,o=0){const i=(0,u.useRef)(),l=(0,u.useRef)(),g=(0,u.useRef)(r),F=(0,u.useRef)(),H=()=>{i.current&&(clearTimeout(i.current),i.current=void 0),l.current&&(clearTimeout(l.current),l.current=void 0)};return E(H),(0,u.useEffect)(()=>{g.current=r},n),(0,u.useMemo)(()=>{const G=()=>{if(H(),!F.current)return;const b=F.current;F.current=void 0,g.current.apply(b.this,b.args)},_=function(...b){i.current&&clearTimeout(i.current),F.current={args:b,this:this},i.current=setTimeout(G,a),o>0&&!l.current&&(l.current=setTimeout(G,o))};return Object.defineProperties(_,{length:{value:r.length},name:{value:`${r.name||"anonymous"}__debounced__${a}`}}),_},[a,o,...n])}function c(r,n,a,o=0){(0,u.useEffect)(s(r,n,a,o),n)}var U=t(48108),D=t(47966),K=t(53318),C=t(18139),O=t(87290),m=t(30043);function J({enabled:r}){const n=(0,C.gf)(m.v),[a]=(0,u.useState)(async()=>{if(!r)return[];const o="relations.ownedBy";return n.getEntityFacets({facets:[o]}).then(i=>i.facets[o].map(l=>l.value).map(l=>{const{kind:g,name:F,namespace:H}=(0,d.KU)(l);return{apiVersion:"backstage.io/v1beta1",kind:g,metadata:{name:F,namespace:H}}}).sort((l,g)=>l.kind.localeCompare(g.kind,"en-US")||l.metadata.namespace.localeCompare(g.metadata.namespace,"en-US")||l.metadata.name.localeCompare(g.metadata.name,"en-US"))).catch(()=>[])});return(0,O.A)(async(o,i)=>{const l=await a;if(!l)return{items:[]};const g=i?.limit??20,{text:F,start:H}=Z(o),G=l.filter(b=>rt(F,b)),_=H+g;return{items:G.slice(0,_),...k({entities:G,limit:_,payload:{text:F,start:_}})}},[a],{loading:!0,value:{items:[]}})}function Z(r){return X(r)&&r.cursor?JSON.parse(atob(r.cursor)):{text:r.text||"",start:0}}function X(r){return!!r.cursor}function k({entities:r,limit:n,payload:a}){return r.length>n?{cursor:btoa(JSON.stringify(a))}:{}}function rt(r,n){const a=r.trim();return n.kind.includes(a)||n.metadata.namespace?.includes(a)||n.metadata.name.includes(a)}function I(){const r=(0,C.gf)(m.v);return(0,O.A)(async(n,a)=>{const o=n,i=n,l=a?.limit??20;if(i.cursor){const F=await r.queryEntities({cursor:i.cursor,limit:l});return{cursor:F.pageInfo.nextCursor,items:[...i.items,...F.items]}}const g=await r.queryEntities({fullTextFilter:{term:o.text||"",fields:["metadata.name","kind","spec.profile.displayname","metadata.title"]},filter:{kind:["User","Group"]},orderFields:[{field:"metadata.name",order:"asc"}],limit:l});return{cursor:g.pageInfo.nextCursor,items:g.items}},[],{loading:!0})}var V=t(76842);function B({mode:r,initialSelectedOwnersRefs:n}){const a=r==="owners-only",o=I(),i=J({enabled:a}),[l,g]=a?i:o;return[l,g,w({enabled:!a,initialSelectedOwnersRefs:n})]}function w({enabled:r,initialSelectedOwnersRefs:n}){const a=(0,u.useRef)({}),o=(0,C.gf)(m.v),[,i]=(0,O.A)(async()=>{(await o.getEntitiesByRefs({entityRefs:n})).items.forEach(g=>{g&&(a.current[(0,d.U2)(g)]=g)})},[]);return(0,V.u)(()=>{r&&n.length>0&&i()}),{getEntity:l=>a.current[l],setEntity:l=>{a.current[(0,d.U2)(l)]=l}}}var Q=t(46123),ut=t(46509),S=t(96403),q=t(80084),ot=t(10265),Y=t(57101);const tt=(0,T.A)({root:{},label:{},input:{},fullWidth:{width:"100%"},boxLabel:{width:"100%",textOverflow:"ellipsis",overflow:"hidden"}},{name:"CatalogReactEntityOwnerPicker"}),et=(0,v.A)(r=>({label:{width:"100%"},root:{width:"90%"}}),{name:"FixedWidthFormControlLabel"})(M.A),it=(0,e.jsx)(L.A,{fontSize:"small"}),lt=(0,e.jsx)(j.A,{fontSize:"small"});function x(r){const n=tt(),a=r.entity.kind.toLocaleLowerCase("en-US")==="group",{primaryTitle:o}=(0,ut.f)(r.entity);return(0,e.jsx)(P.A,{className:n.fullWidth,children:(0,e.jsx)(et,{className:n.fullWidth,control:(0,e.jsx)(h.A,{icon:it,checkedIcon:lt,checked:r.isSelected}),onClick:i=>i.preventDefault(),label:(0,e.jsx)(y.Ay,{title:o,children:(0,e.jsxs)(P.A,{display:"flex",alignItems:"center",children:[a?(0,e.jsx)(D.A,{fontSize:"small"}):(0,e.jsx)(U.A,{fontSize:"small"}),"\xA0",(0,e.jsx)(P.A,{className:n.boxLabel,children:(0,e.jsx)(f.A,{noWrap:!0,children:o})})]})})})})}const R=r=>{const n=tt(),{mode:a="owners-only"}=r||{},{updateFilters:o,filters:i,queryParameters:{owners:l}}=(0,z.nK)(),[g,F]=(0,u.useState)(""),{t:H}=(0,ot.i)(q.j),G=(0,u.useMemo)(()=>[l].flat().filter(Boolean),[l]),[_,b]=(0,u.useState)(G.length?G:i.owners?.values??[]),[{value:nt,loading:ft},gt,at]=B({mode:a,initialSelectedOwnersRefs:_});c(()=>gt({text:g}),[g,gt],250);const Et=nt?.items||[];return(0,u.useEffect)(()=>{if(G.length){const N=new p.N9(G);b(N.values)}},[G]),(0,u.useEffect)(()=>{o({owners:_.length?new p.N9(_):void 0})},[_,o]),["user","group"].includes(i.kind?.value.toLocaleLowerCase("en-US")||"")?null:(0,e.jsx)(P.A,{className:n.root,pb:1,pt:1,children:(0,e.jsx)(Y.Q,{label:H("entityOwnerPicker.title"),multiple:!0,disableCloseOnSelect:!0,loading:ft,options:Et,value:_,getOptionSelected:(N,W)=>typeof W=="string"?(0,d.U2)(N)===W:N===W,getOptionLabel:N=>{const W=typeof N=="string"?at.getEntity(N)||(0,d.KU)(N,{defaultKind:"group",defaultNamespace:"default"}):N;return(0,K.Z)(W,(0,K.S)(W))},onChange:(N,W)=>{F(""),b(W.map(dt=>{const pt=typeof dt=="string"?dt:(0,d.U2)(dt);return typeof dt!="string"&&at.setEntity(dt),pt}))},filterOptions:N=>N,renderOption:(N,{selected:W})=>(0,e.jsx)(x,{entity:N,isSelected:W}),name:"owner-picker",onInputChange:(N,W)=>{F(W)},ListboxProps:{onScroll:N=>{const W=N.currentTarget;Math.abs(W.scrollHeight-W.clientHeight-W.scrollTop)<1&&nt?.cursor&&gt({items:nt.items,cursor:nt.cursor})},"data-testid":"owner-picker-listbox"},LabelProps:{className:n.label},TextFieldProps:{className:n.input}})})}},41260:(st,A,t)=>{var e,d=t(4293),P=t(78920);e={value:!0},A.A=void 0;var h=P(t(14041)),M=d(t(74044)),f=(0,M.default)(h.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank");A.A=f},44148:(st,A,t)=>{var e,d=t(4293),P=t(78920);e={value:!0},A.A=void 0;var h=P(t(14041)),M=d(t(74044)),f=(0,M.default)(h.createElement("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox");A.A=f},44861:(st,A,t)=>{t.d(A,{I:()=>L});var e=t(78560),d=t(18139),P=t(14041),h=t(11746),M=t(46123),f=t.n(M),y=t(9974),T=t(96403),v=t.n(T);function j(u){return typeof u=="string"?u:(0,e.U2)(u)}function L(){const u=(0,d.gf)(y.a),z=(0,h.A)((0,P.useMemo)(()=>u.starredEntitie$(),[u]),new Set),p=(0,P.useCallback)(E=>z.has(j(E)),[z]),$=(0,P.useCallback)(E=>u.toggleStarred(j(E)).then(),[u]);return{starredEntities:z,toggleStarredEntity:$,isStarredEntity:p}}},47966:(st,A,t)=>{var e,d=t(4293),P=t(78920);e={value:!0},A.A=void 0;var h=P(t(14041)),M=d(t(74044)),f=(0,M.default)(h.createElement("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"}),"Group");A.A=f},49724:(st,A,t)=>{t.d(A,{I5:()=>v,Kf:()=>z,N9:()=>T,V3:()=>y,gM:()=>h,gZ:()=>u,mT:()=>p,qA:()=>M,q_:()=>f,tN:()=>L,z:()=>j});var e=t(78560),d=t(97214),P=t(699);class h{constructor(s,c){this.value=s,this.label=c}getCatalogFilters(){return{kind:this.value}}toQueryValue(){return this.value}}class M{constructor(s){this.value=s}getTypes(){return Array.isArray(this.value)?this.value:[this.value]}getCatalogFilters(){return{"spec.type":this.getTypes()}}toQueryValue(){return this.getTypes()}}class f{constructor(s){this.values=s}filterEntity(s){return this.values.every(c=>(s.metadata.tags??[]).includes(c))}getCatalogFilters(){return{"metadata.tags":this.values}}toQueryValue(){return this.values}}class y{constructor(s){this.value=s}filterEntity(s){const c=this.toUpperArray(this.value.split(/\s/)),U=this.toUpperArray([s.metadata.tags]),D=this.toUpperArray([s.metadata.name,s.metadata.title,s.spec?.profile?.displayName]);for(const K of c)if(U.every(C=>C!==K)&&D.every(C=>!C.includes(K)))return!1;return!0}getFullTextFilters(){return{term:this.value,fields:["metadata.name","metadata.title","spec.profile.displayName"]}}toQueryValue(){return this.value}toUpperArray(s){return s.flat().filter(c=>!!c).map(c=>c.toLocaleUpperCase("en-US"))}}class T{values;constructor(s){this.values=s.reduce((c,U)=>{try{return c.push((0,e.U2)((0,e.KU)(U,{defaultKind:"Group"}))),c}catch{return c}},[])}getCatalogFilters(){return{"relations.ownedBy":this.values}}filterEntity(s){return this.values.some(c=>(0,P.t)(s,d.vv).some(U=>(0,e.U2)(U)===c))}toQueryValue(){return this.values}}class v{constructor(s){this.values=s}getCatalogFilters(){return{"spec.lifecycle":this.values}}filterEntity(s){return this.values.some(c=>s.spec?.lifecycle===c)}toQueryValue(){return this.values}}class j{constructor(s){this.values=s}getCatalogFilters(){return{"metadata.namespace":this.values}}filterEntity(s){return this.values.some(c=>s.metadata.namespace===c)}toQueryValue(){return this.values}}class L{constructor(s,c){this.value=s,this.refs=c}static owned(s){return new L("owned",s)}static all(){return new L("all")}static starred(s){return new L("starred",s)}getCatalogFilters(){return this.value==="owned"?{"relations.ownedBy":this.refs??[]}:this.value==="starred"?{"metadata.name":this.refs?.map(s=>(0,e.KU)(s).name)??[]}:{}}filterEntity(s){if(this.value==="starred")return this.refs?.includes((0,e.U2)(s))??!0;if(this.value==="owned"){const c=(0,P.t)(s,d.vv);return this.refs?.some(U=>c.some(D=>(0,e.U2)(D)===U))??!1}return!0}toQueryValue(){return this.value}}class u{constructor(s,c,U){this.value=s,this.isOwnedEntity=c,this.isStarredEntity=U}filterEntity(s){switch(this.value){case"owned":return this.isOwnedEntity(s);case"starred":return this.isStarredEntity(s);default:return!0}}toQueryValue(){return this.value}}class z{constructor(s){this.value=s}getCatalogFilters(){return this.value?{"metadata.annotations.backstage.io/orphan":String(this.value)}:{}}filterEntity(s){const c=s.metadata.annotations?.["backstage.io/orphan"];return c!==void 0&&this.value.toString()===c}}class p{constructor(s){this.value=s}filterEntity(s){const c=s?.status?.items?.length>0;return c!==void 0&&this.value===c}}class ${constructor(s){this.values=s}getOrderFilters(){return this.values.map(([s,c])=>({field:s,order:c}))}toQueryValue(){return this.values.flat()}}},56420:(st,A,t)=>{t.d(A,{Y:()=>rt});var e=t(31085),d=t(95208),P=t(18139),h=t(54195),M=t(77125),f=t(64947),y=t(93453),T=t(29365),v=t(46423),j=t(5951),L=t(26343),u=t(28233),z=t(55197),p=t(58837),$=t(72501),E=t(5893),s=t(14041),c=t(45250),U=t.n(c),D=t(70209),K=t(92483),C=t(75202),O=t(89475),m=t(10265);const J=(0,p.A)({popoverList:{minWidth:260,maxWidth:400},menuItem:{whiteSpace:"normal"}},{name:"BackstageSupportButton"}),Z=({icon:I})=>{const V=(0,d.n)(),B=I?V.getSystemIcon(I)??K.NT:K.NT;return(0,e.jsx)(B,{})},X=({link:I})=>(0,e.jsx)(C.N_,{to:I.url,children:I.title??I.url}),k=({item:I})=>(0,e.jsxs)(L.A,{button:!1,children:[(0,e.jsx)(v.A,{children:(0,e.jsx)(Z,{icon:I.icon})}),(0,e.jsx)(j.A,{primary:I.title,secondary:I.links?.reduce((V,B,w)=>[...V,w>0&&(0,e.jsx)("br",{},w),(0,e.jsx)(X,{link:B},B.url)],[])})]});function rt(I){const{t:V}=(0,m.i)(O.O),{title:B,items:w,children:Q}=I,{items:ut}=(0,D.l)(),[S,q]=(0,s.useState)(!1),[ot,Y]=(0,s.useState)(null),tt=J(),et=(0,P.gf)(h.U).getOptionalConfig("app.support"),it=(0,E.A)(R=>R.breakpoints.down("sm")),lt=R=>{Y(R.currentTarget),q(!0)},x=()=>{q(!1)};return et?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(M.A,{display:"flex",ml:1,children:it?(0,e.jsx)(T.A,{color:"primary",size:"small",onClick:lt,"data-testid":"support-button","aria-label":"Support",children:(0,e.jsx)(K.NT,{})}):(0,e.jsx)(f.A,{"data-testid":"support-button","aria-label":"Support",color:"primary",onClick:lt,startIcon:(0,e.jsx)(K.NT,{}),children:V("supportButton.title")})}),(0,e.jsxs)(z.Ay,{"data-testid":"support-button-popover",open:S,anchorEl:ot,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:x,children:[(0,e.jsxs)(u.A,{className:tt.popoverList,autoFocusItem:!!ot,children:[B&&(0,e.jsx)(L.A,{button:!1,alignItems:"flex-start",className:tt.menuItem,children:(0,e.jsx)($.A,{variant:"subtitle1",children:B})}),s.Children.map(Q,(R,r)=>(0,e.jsx)(L.A,{button:!1,alignItems:"flex-start",className:tt.menuItem,children:R},`child-${r}`)),(w??ut).map((R,r)=>(0,e.jsx)(k,{item:R},`item-${r}`))]}),(0,e.jsx)(y.A,{children:(0,e.jsx)(f.A,{color:"primary",onClick:x,"aria-label":"Close",children:V("supportButton.close")})})]})]}):null}},56643:(st,A,t)=>{t.d(A,{y:()=>K});var e=t(31085),d=t(77125),P=t(58837),h=t(14041),M=t(18139),f=t(73466),y=t(30043),T=t(69076),v=t(86901),j=t(44148),L=t(41260);const u=(0,e.jsx)(L.A,{fontSize:"small"}),z=(0,e.jsx)(j.A,{fontSize:"small"});function p({selected:C}){return(0,e.jsx)(T.A,{icon:u,checkedIcon:z,checked:C})}const $=(0,h.memo)(C=>{const{selected:O,value:m,availableOptions:J,showCounts:Z}=C,X=Z?`${m} (${J?.[m]})`:m;return(0,e.jsx)(v.A,{control:(0,e.jsx)(p,{selected:O}),label:X,onClick:k=>k.preventDefault()})});var E=t(18453),s=t(15998),c=t(57101),U=t(45250);const D=(0,P.A)({root:{},label:{textTransform:"none",fontWeight:"bold"}},{name:"CatalogReactEntityAutocompletePicker"});function K(C){const{label:O,name:m,path:J,showCounts:Z,Filter:X,InputProps:k,initialSelectedOptions:rt=[],filtersForAvailableValues:I=["kind"],hidden:V}=C,B=D(),{updateFilters:w,filters:Q,queryParameters:{[m]:ut}}=(0,E.nK)(),S=(0,M.gf)(y.v),q=I.map(r=>Q[r]),{value:ot}=(0,f.A)(async()=>{const r=J,{facets:n}=await S.getEntityFacets({facets:[r],filter:(0,s.Rr)(q.filter(Boolean))});return Object.fromEntries(n[r].map(({value:a,count:o})=>[a,o]))},[...q]),Y=(0,h.useMemo)(()=>[ut].flat().filter(Boolean),[ut]),tt=Q[m]?.values,[et,it]=(0,h.useState)(Y.length?Y:tt??rt);(0,h.useEffect)(()=>{Y.length&&it(Y)},[Y]);const lt=Object.keys(ot??{}),x=et.length&&lt.length;(0,h.useEffect)(()=>{w({[m]:x?new X(et):void 0})},[m,x,et,X,w]),(0,h.useEffect)(()=>{if(!x)return;const r=tt??[];(0,U.isEqual)(r,et)||it(r)},[tt]);const R=Q[m];return R&&typeof R=="object"&&!("values"in R)||!lt.length||V?null:(0,e.jsx)(d.A,{className:B.root,pb:1,pt:1,children:(0,e.jsx)(c.Q,{multiple:!0,disableCloseOnSelect:!0,label:O,name:`${String(m)}-picker`,options:lt,value:et,TextFieldProps:k,onChange:(r,n)=>it(n),renderOption:(r,{selected:n})=>(0,e.jsx)($,{selected:n,value:r,availableOptions:ot,showCounts:!!Z})})})}},56829:(st,A,t)=>{t.d(A,{m:()=>T});var e=t(31085),d=t(58837),P=t(49724),h=t(56643),M=t(80084),f=t(10265);const y=(0,d.A)({input:{}},{name:"CatalogReactEntityTagPicker"}),T=v=>{const j=y(),{t:L}=(0,f.i)(M.j);return(0,e.jsx)(h.y,{label:L("entityTagPicker.title"),name:"tags",path:"metadata.tags",Filter:P.q_,showCounts:v.showCounts,InputProps:{className:j.input},initialSelectedOptions:v.initialFilter?v.initialFilter:[],hidden:v.hidden})}},57101:(st,A,t)=>{t.d(A,{Q:()=>C});var e=t(31085),d=t(77125),P=t(72501),h=t(4321),M=t(87263),f=t(16249),y=t(33145),T=t(58837),v=t(7031),j=t(99703),L=t(6924),u=t(61783),z=t(14041),p=t(45250),$=t.n(p),E=t(53373),s=t.n(E);const c=(0,T.A)(O=>({root:{margin:O.spacing(1,0)},label:{position:"relative",fontWeight:"bold",fontSize:O.typography.body2.fontSize,fontFamily:O.typography.fontFamily,color:O.palette.text.primary,"& > span":{top:0,left:0,position:"absolute"}}}),{name:"BackstageAutocomplete"}),U=(0,v.A)(O=>(0,j.A)({root:{},paper:{margin:0},hasClearIcon:{},hasPopupIcon:{},focused:{},inputRoot:{marginTop:24,backgroundColor:O.palette.background.paper,"$root$hasClearIcon$hasPopupIcon &":{paddingBlock:O.spacing(.75),paddingInlineStart:O.spacing(.75)},"$root$focused &":{outline:"none"},"$root &:hover > fieldset":{borderColor:"#ced4da"},"$root$focused & > fieldset":{borderWidth:1,borderColor:O.palette.primary.main}},popupIndicator:{padding:0,margin:0,color:"#616161","&:hover":{backgroundColor:"unset"},'& [class*="MuiTouchRipple-root"]':{display:"none"}},endAdornment:{"$root$hasClearIcon$hasPopupIcon &":{right:4}},input:{"$root$hasClearIcon$hasPopupIcon &":{fontSize:O.typography.body1.fontSize,paddingBlock:O.spacing(.8125)}}}),{name:"BackstageAutocompleteBase"})(u.Ay),D=O=>(0,e.jsx)(M.A,{...O,transition:!0,placement:"bottom-start",children:({TransitionProps:m})=>(0,e.jsx)(y.A,{...m,style:{transformOrigin:"0 0 0"},children:(0,e.jsx)(d.A,{children:O.children})})}),K=O=>(0,e.jsx)(h.A,{...O,elevation:8});function C(O){const{label:m,name:J,LabelProps:Z,TextFieldProps:X,...k}=O,rt=c(),I=(0,z.useCallback)(B=>(0,e.jsx)(f.A,{...(0,p.merge)(B,X),variant:"outlined"}),[X]),V=(0,e.jsx)(U,{size:"small",...k,renderInput:k.renderInput??I,popupIcon:(0,e.jsx)(L.A,{"data-testid":`${J}-expand`}),PaperComponent:K,PopperComponent:D});return(0,e.jsx)(d.A,{className:rt.root,children:m?(0,e.jsxs)(P.A,{...Z,className:s()(rt.label,Z?.className),component:"label",children:[(0,e.jsx)(d.A,{component:"span",children:m}),V]}):V})}},77509:(st,A,t)=>{t.d(A,{GI:()=>$});var e=t(31085),d=t(14041),P=t(77125),h=t(64947),M=t(73845),f=t(42899),y=t(72501),T=t(5893),v=t(54917),j=t(65859),L=t(80084),u=t(10265);const z=E=>{const s=(0,T.A)(C=>C.breakpoints.down(E.options?.drawerBreakpoint??"md"),{noSsr:!0}),c=(0,v.A)(),[U,D]=(0,d.useState)(!1),{t:K}=(0,u.i)(L.j);return s?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(h.A,{style:{marginTop:c.spacing(1),marginLeft:c.spacing(1)},onClick:()=>D(!0),startIcon:(0,e.jsx)(j.A,{}),children:K("catalogFilter.buttonTitle")}),(0,e.jsx)(M.Ay,{open:U,onClose:()=>D(!1),anchor:E.options?.drawerAnchor??"left",disableAutoFocus:!0,keepMounted:!0,variant:"temporary",children:(0,e.jsxs)(P.A,{m:2,children:[(0,e.jsx)(y.A,{variant:"h6",component:"h2",style:{marginBottom:c.spacing(1)},children:K("catalogFilter.title")}),E.children]})})]}):(0,e.jsx)(f.A,{item:!0,lg:2,children:E.children})},p=E=>(0,e.jsx)(f.A,{item:!0,xs:12,lg:10,children:E.children}),$=E=>(0,e.jsx)(f.A,{container:!0,style:{position:"relative"},children:E.children});$.Filters=z,$.Content=p}}]);})();

//# sourceMappingURL=7248.7271d4a8.chunk.js.map